<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<input id="url">
<textarea id="body"></textarea>
<button id="get">get</button>
<button id="post">post</button>
<button id="image">image</button>
<input id="fileInput" type="file">
<button id="file">file</button>
<p id="response"></p>
<img id="img">
<script src="http://localhost:8888/srequest"></script>
<script>
    function request(url, successFunc = response => console.log(response), errorFunc = response => console.log(response), body = null) {
        // let promise = fetch(url, body !== null ? {
        //     method: "POST",
        //     body
        // } : {
        //     method: "GET"
        // });
        // promise.then(response => response.json().then(data => successFunc(data)));
        // promise.catch(response => errorFunc(response));
        if (body == null) {
            // get(url, {
            //     onSuccess(data, status, headers, response) {
            //         console.log(data);
            //         console.log(status);
            //         console.log(headers);
            //         console.log(response);
            //         successFunc(data);
            //     },
            //     onError(data, status, headers, response) {
            //         console.log(data);
            //         console.log(status);
            //         console.log(headers);
            //         console.log(response);
            //         errorFunc(data);
            //     }
            // });
            let f = async () => {
                let {data, status, headers, response} = await getSync(url);
                console.log(data);
                console.log(status);
                console.log(headers);
                console.log(response);
                successFunc(data);
            };
            f();
        }
        else {
            // post(url, body, {
            //     onSuccess(data, status, headers, response) {
            //         console.log(data);
            //         console.log(status);
            //         console.log(headers);
            //         console.log(response);
            //         successFunc(data);
            //
            //     },
            //     onError(data, status, headers, response) {
            //         console.log(data);
            //         console.log(status);
            //         console.log(headers);
            //         console.log(response);
            //         errorFunc(data);
            //     }
            // });
            let f = async () => {
                let {data, status, headers, response} = await postSync(url, body);
                console.log(data);
                console.log(status);
                console.log(headers);
                console.log(response);
                successFunc(data);
            };
            f();
        }
    }

    function formdataRequest(url, data, successFunc = response => console.log(response), errorFunc = response => console.log(response)) {
        // let formdata = new FormData();
        // // for (let key of data) {
        // //     formdata.append(key, data[key]);
        // // }
        // Object.keys(data).forEach(value => {
        //     formdata.append(value, data[value]);
        // });
        // request(url, successFunc, errorFunc, formdata);
        // console.log(data);
        // formData(url, data, {
        //     onSuccess(data, status, headers, response) {
        //         console.log(data);
        //         console.log(status);
        //         console.log(headers);
        //         console.log(response);
        //         successFunc(data);
        //
        //     },
        //     onError(data, status, headers, response) {
        //         console.log(data);
        //         console.log(status);
        //         console.log(headers);
        //         console.log(response);
        //         errorFunc(data);
        //     }
        // });
        let f = async () => {
            let {data: d, status, headers, response} = await formDataSync(url, data);
            console.log(d);
            console.log(status);
            console.log(headers);
            console.log(response);
            successFunc(d);
        };
        f();
    }

    function fromCharCodes(charCodes) {
        let str = "";
        charCodes.forEach(value => {
            str += String.fromCharCode(value);
        });
        return str
    }

    function toBase64(arr) {
        //arr = new Uint8Array(arr) if it's an ArrayBuffer
        return btoa(
            arr.reduce((data, byte) => data + String.fromCharCode(byte), '')
        );
    }

    document.querySelector("#get").addEventListener("click", () => {
        request(document.querySelector("#url").value, response => {
            document.querySelector("#response").innerHTML = JSON.stringify(response);
            console.log(response);
        }, response => {
            document.querySelector("#response").innerHTML = "error";
            console.log(response);
        });
        alert("");
    });

    document.querySelector("#post").addEventListener("click", () => {
        request(document.querySelector("#url").value, response => {
            document.querySelector("#response").innerHTML = JSON.stringify(response);
            console.log(response);
        }, response => {
            document.querySelector("#response").innerHTML = "error";
            console.log(response);
        }, document.querySelector("#body").value);
        alert("");
    });

    document.querySelector("#image").addEventListener("click", () => {
        request(document.querySelector("#url").value, response => {
            document.querySelector("#response").innerHTML = fromCharCodes(response.file.data);
            document.querySelector("#img").src = `data:image/png;base64,${toBase64(response.file.data)}`;
            console.log(`data:image/png;base64,${toBase64(response.file.data)}`);
            console.log(response);
            let newTab = window.open();
            newTab.document.body.innerHTML = `<img src="data:image/png;base64,${toBase64(response.file.data)}">`
        }, response => {
            document.querySelector("#response").innerHTML = "error";
            console.log(response);
        }, document.querySelector("#body").value);
        alert("");
    });

    document.querySelector("#file").addEventListener("click", () => {
        formdataRequest(document.querySelector("#url").value, {
            ...JSON.parse(document.querySelector("#body").value),
            file: document.querySelector("#fileInput").files[0]
        }, response => {
            document.querySelector("#response").innerHTML = JSON.stringify(response);
            console.log(response);
        }, response => {
            document.querySelector("#response").innerHTML = "error";
            console.log(response);
        })
        alert("");
    });
</script>
</body>
</html>